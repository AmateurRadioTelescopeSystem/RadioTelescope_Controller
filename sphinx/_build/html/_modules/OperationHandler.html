
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>OperationHandler &#8212; Radio Telescope Controller 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for OperationHandler</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtNetwork</span>
<span class="kn">from</span> <span class="nn">Core.Astronomy</span> <span class="k">import</span> <span class="n">Astronomy</span>
<span class="kn">from</span> <span class="nn">Core.Handlers</span> <span class="k">import</span> <span class="n">SimulationHandler</span>
<span class="kn">from</span> <span class="nn">Core.Handlers</span> <span class="k">import</span> <span class="n">TLEHandler</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="OpHandler"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler">[docs]</a><span class="k">class</span> <span class="nc">OpHandler</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">posDataShow</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;posDataShow&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcpClient</span><span class="p">,</span> <span class="n">tcpServer</span><span class="p">,</span> <span class="n">tcpStellarium</span><span class="p">,</span> <span class="n">tcpClThread</span><span class="p">,</span> <span class="n">tcpServThread</span><span class="p">,</span>
                 <span class="n">tcpStelThread</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">cfgData</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Operations handler class constructor.</span>

<span class="sd">        :param tcpClient:</span>
<span class="sd">        :param tcpServer:</span>
<span class="sd">        :param tcpStellarium:</span>
<span class="sd">        :param tcpClThread:</span>
<span class="sd">        :param tcpServThread:</span>
<span class="sd">        :param tcpStelThread:</span>
<span class="sd">        :param ui:</span>
<span class="sd">        :param cfgData:</span>
<span class="sd">        :param parent:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OpHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span> <span class="o">=</span> <span class="n">tcpClient</span>  <span class="c1"># TCP client object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span> <span class="o">=</span> <span class="n">tcpServer</span>  <span class="c1"># TCP RPi server object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span> <span class="o">=</span> <span class="n">tcpStellarium</span>  <span class="c1"># TCP Stellarium server object</span>

        <span class="c1"># Create the thread varaible for the class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span> <span class="o">=</span> <span class="n">tcpClThread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span> <span class="o">=</span> <span class="n">tcpServThread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span> <span class="o">=</span> <span class="n">tcpStelThread</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">ui</span>  <span class="c1"># User interface handling object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span> <span class="o">=</span> <span class="n">cfgData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>  <span class="c1"># Data logger object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span> <span class="o">=</span> <span class="n">Astronomy</span><span class="o">.</span><span class="n">Calculations</span><span class="p">(</span><span class="n">cfg_data</span><span class="o">=</span><span class="n">cfgData</span><span class="p">)</span>  <span class="c1"># Astronomy calculations object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>  <span class="c1"># The dish position is saved for change comparison</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Keep the motor status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_ra</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_dec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simStarted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tle_operations</span> <span class="o">=</span> <span class="n">TLEHandler</span><span class="o">.</span><span class="n">TLEHandler</span><span class="p">(</span><span class="n">cfgData</span><span class="p">)</span>  <span class="c1"># Create the TLE handling object</span>

        <span class="c1"># Simulation thread operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span> <span class="o">=</span> <span class="n">SimulationHandler</span><span class="o">.</span><span class="n">SimulHandler</span><span class="p">(</span><span class="n">tcpStellarium</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start the simulation thread</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">textBrowser</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="s2">&quot;&lt;html&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 36px;</span><span class="se">\&quot;</span><span class="s2"> colspan=</span><span class="se">\&quot;</span><span class="s2">2</span><span class="se">\&quot;</span><span class="s2">&gt;&quot;</span>
            <span class="s2">&quot;&lt;strong&gt;System&lt;/strong&gt;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 49px;</span><span class="se">\&quot;</span><span class="s2"> colspan=</span><span class="se">\&quot;</span><span class="s2">2</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;strong&gt;Equatorial&lt;/strong&gt;&quot;</span>
            <span class="s2">&quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 26px;</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;strong&gt;C1&lt;/strong&gt;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;strong&gt;C2&lt;/strong&gt;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 20px;</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;strong&gt;RA&lt;/strong&gt;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 29px;</span><span class="se">\&quot;</span><span class="s2">&gt;&quot;</span>
            <span class="s2">&quot;&lt;strong&gt;DEC&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 26px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 20px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 29px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 26px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 10px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 20px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&quot;</span>
            <span class="s2">&quot;&lt;td style=</span><span class="se">\&quot;</span><span class="s2">width: 29px;</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="OpHandler.start"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializer of the thread.</span>
<span class="sd">        Make all the necessary initializations when the thread starts</span>

<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Operations handler thread started&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signalConnections</span><span class="p">()</span>  <span class="c1"># Make all the necessary signal connections</span>

        <span class="n">autoconStell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTCPStellAutoConnStatus</span><span class="p">()</span>  <span class="c1"># See if auto-connection at startup is enabled</span>
        <span class="n">autoconRPi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTCPAutoConnStatus</span><span class="p">()</span>  <span class="c1"># Auto-connection preference for the RPi server and client</span>

        <span class="c1"># Try to get a new TLE, if the one we have is outdated</span>
        <span class="n">tle_expiry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tle_operations</span><span class="o">.</span><span class="n">tle_expiry_checker</span><span class="p">()</span>  <span class="c1"># Check the validity of the file</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tle_expiry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">tle_expiry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">tle_expiry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">tle_expiry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;File not found&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleStatusInfoSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Just initialize the widget</span>
            <span class="n">tle_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tle_operations</span><span class="o">.</span><span class="n">tle_retriever</span><span class="p">()</span>  <span class="c1"># Get the new TLE file</span>

            <span class="k">if</span> <span class="n">tle_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;Success^TLE file(s) updated&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;Error^There was a problem getting TLE file(s).^&quot;</span>
                <span class="n">tle_status_msg</span> <span class="o">+=</span> <span class="n">tle_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">tle_expiry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleStatusInfoSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Just initialize the widget</span>
            <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;Error^There was a problem checking TLE file(s).^&quot;</span>
            <span class="n">tle_status_msg</span> <span class="o">+=</span> <span class="n">tle_expiry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tle_status_msg</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleStatusInfoSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">tle_status_msg</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleInfoMsgBox</span><span class="o">.</span><span class="n">clickedButton</span><span class="p">():</span>
                <span class="k">continue</span>

        <span class="c1"># If auto-connection is selected for thr TCP section, then do as requested</span>
        <span class="k">if</span> <span class="n">autoconStell</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start the server thread, since auto start is enabled</span>
        <span class="k">if</span> <span class="n">autoconRPi</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start the client thread, since auto start is enabled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start the RPi server thread, since auto start is enabled</span></div>

    <span class="c1"># Client connection button handling method</span>
<div class="viewcode-block" id="OpHandler.connectButtonR"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.connectButtonR">[docs]</a>    <span class="k">def</span> <span class="nf">connectButtonR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectRadioTBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Disconnect&quot;</span> <span class="ow">or</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectRadioTBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Disconnect from the client</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Attempt a connection with the client</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the thread is running and it is not yet connected, attempt a reconnection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">reConnectSigC</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

    <span class="c1"># Stellarium server connection handling method</span>
<div class="viewcode-block" id="OpHandler.connectButtonS"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.connectButtonS">[docs]</a>    <span class="k">def</span> <span class="nf">connectButtonS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectStellariumBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Disable&quot;</span> <span class="ow">or</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectStellariumBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Quit the currently running thread</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Attempt a connection with the client</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the thread is running and it is not yet connected, attempt a reconnection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">reConnectSigS</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

    <span class="c1"># RPi server connection handling method</span>
<div class="viewcode-block" id="OpHandler.connectButtonRPi"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.connectButtonRPi">[docs]</a>    <span class="k">def</span> <span class="nf">connectButtonRPi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">serverRPiConnBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Disable&quot;</span> <span class="ow">or</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">serverRPiConnBtn</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>  <span class="c1"># Quit the currently running thread</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Attempt a connection with the client</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the thread is running and it is not yet connected, attempt a reconnection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">reConnectSigR</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.testConnButton"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.testConnButton">[docs]</a>    <span class="k">def</span> <span class="nf">testConnButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientConTestChkBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;Test</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.motorsEnableButton"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.motorsEnableButton">[docs]</a>    <span class="k">def</span> <span class="nf">motorsEnableButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;DISABLE_MOTORS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;ENABLE_MOTORS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.initialCommands"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.initialCommands">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sendNewConCommands&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">initialCommands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO add more commands to send, like system check reports and others</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;SEND_HOME_STEPS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Get the steps from home for each motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;REPORT_MOTOR_STATUS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Get the current status of the motors</span></div>

    <span class="c1"># Dta received from the client connected to the RPi server</span>
<div class="viewcode-block" id="OpHandler.clientDataRx"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.clientDataRx">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dataClientRX&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">clientDataRx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data reception from the TCP client.</span>
<span class="sd">        Receive the data sent from client and decide how to act</span>

<span class="sd">        :param data: Data received from the client</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;MOTORS_ENABLED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;MOTORS_DISABLED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splt_str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Try to split the string, and if it splits then a command is sent</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splt_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STEPS-FROM-HOME&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setHomeSteps</span><span class="p">(</span><span class="n">splt_str</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># Set the current away from home position steps</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setManContStepsSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setManContStepsSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MAX-STEPS-TO-DO&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;RA&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_ra</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_dec</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">splt_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DEC&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_dec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_ra</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Data received from client (Connected to remote RPi server): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setGUIFromClientSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># If it is not split yet, send the command</span></div>

<div class="viewcode-block" id="OpHandler.stellCommSend"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.stellCommSend">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;clientCommandSendStell&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stellCommSend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the appropriate command according to the selected mode. Data is received from Stellarium (sendClientConn)</span>

<span class="sd">        :param radec: A list containing the data received from Stellarium</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">home_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getHomeSteps</span><span class="p">()</span>  <span class="c1"># Return a list with the steps way from home position</span>
            <span class="n">tr_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">transitTimeValue</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">stellariumOperationSelect</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
                <span class="n">ra_degrees</span> <span class="o">=</span> <span class="n">radec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">15.0</span>  <span class="c1"># Stellarium returns right ascension is hours, so we convert to degrees</span>
                <span class="n">transit_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">transit</span><span class="p">(</span><span class="n">ra_degrees</span><span class="p">,</span> <span class="n">radec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                                        <span class="n">tr_time</span><span class="p">)</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRNST_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">transit_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transit_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>  <span class="c1"># Send the transit command to the RPi</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">stellariumOperationSelect</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Aim and track&quot;</span><span class="p">:</span>
                <span class="n">ra_degrees</span> <span class="o">=</span> <span class="n">radec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">15.0</span>  <span class="c1"># Stellarium returns right ascension is hours, so we convert to degrees</span>
                <span class="n">trk_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">transit</span><span class="p">(</span><span class="n">ra_degrees</span><span class="p">,</span> <span class="n">radec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRK_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="s2">_RA-SPEEDD_</span><span class="si">%.5f</span><span class="s2">_DEC-SPEED_</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trk_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">trk_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>  <span class="c1"># Send the tracking command to the RPi</span></div>

    <span class="c1"># Received data from the server that the RPi is connected as a client. Signal is (dataRxFromServ)</span>
<div class="viewcode-block" id="OpHandler.rpiServRcvData"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.rpiServRcvData">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rpiServDataRx&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rpiServRcvData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data sent from the RPi client.</span>
<span class="sd">        Mainly the dish position will be sent</span>

<span class="sd">        :param data: Data received from the TCP connection</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO Remove the degree conversion for the RA, since MPU will send in degrees and not hours</span>
        <span class="n">spltData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Split the string with the set delimiter</span>
        <span class="k">if</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POSUPDATE&quot;</span><span class="p">:</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">hour_angle_to_ra</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spltData</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">15.0</span><span class="p">)</span>  <span class="c1"># Get the RA from the received position</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># Get the DEC from the received position</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ra</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dec</span> <span class="ow">and</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;POSUPDATE&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">sendDataStell</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>  <span class="c1"># Send the position to Stellarium</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posDataShow</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>  <span class="c1"># Send the updated values if they are different</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">]</span>  <span class="c1"># Save the values for later comparison</span>
        <span class="k">elif</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DISHPOS&quot;</span><span class="p">:</span>
            <span class="n">ra_degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">hour_angle_to_ra</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spltData</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">15.0</span><span class="p">)</span>  <span class="c1"># Get the RA from the received HA</span>
            <span class="n">dec_degrees</span> <span class="o">=</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># Get the DEC from the received position</span>
            <span class="n">ra_steps</span> <span class="o">=</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">dec_steps</span> <span class="o">=</span> <span class="n">spltData</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setManContStepsSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="n">ra_steps</span><span class="p">)</span>  <span class="c1"># Update the manual control window</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setManContStepsSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="n">dec_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">sendDataStell</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ra_degrees</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec_degrees</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posDataShow</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ra_degrees</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec_degrees</span><span class="p">))</span>

            <span class="c1"># Update the progress bar</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ra_steps</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_ra</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">onTargetProgress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dec_steps</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">max_steps_to_targ_dec</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">onTargetProgress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span></div>

    <span class="c1"># Command to stop any motion of the radio telescope dish</span>
<div class="viewcode-block" id="OpHandler.stopMovingRT"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.stopMovingRT">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;stopRadioTele&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stopMovingRT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO change the command to the appropriate one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;STOP</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Send the request to stop moving to the RPi server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;A dish motion halt was requested&quot;</span><span class="p">)</span></div>

    <span class="c1"># Functions to connect with the manual control widget</span>
    <span class="c1"># TODO add comments to the functions</span>
<div class="viewcode-block" id="OpHandler.manCont_movRA"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.manCont_movRA">[docs]</a>    <span class="k">def</span> <span class="nf">manCont_movRA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">frequncyInputBox</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">raStepsField</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;MANCONT_MOVRA_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.manCont_movDEC"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.manCont_movDEC">[docs]</a>    <span class="k">def</span> <span class="nf">manCont_movDEC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">frequncyInputBox</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">decStepsField</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;MANCONT_MOVDEC_</span><span class="si">%s</span><span class="s2">_0_</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.manCont_movBoth"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.manCont_movBoth">[docs]</a>    <span class="k">def</span> <span class="nf">manCont_movBoth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">frequncyInputBox</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">step_ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">raStepsField</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">step_dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">decStepsField</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;MANCONT_MOVE_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">step_ra</span><span class="p">,</span> <span class="n">step_dec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.manCont_stop"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.manCont_stop">[docs]</a>    <span class="k">def</span> <span class="nf">manCont_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;MANCONT_STOP</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>  <span class="c1"># Send the stop request in manual control</span></div>

<div class="viewcode-block" id="OpHandler.TCPSettingsHandle"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.TCPSettingsHandle">[docs]</a>    <span class="k">def</span> <span class="nf">TCPSettingsHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">autoconStell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTCPStellAutoConnStatus</span><span class="p">()</span>  <span class="c1"># See if auto-connection at startup is enabled</span>
        <span class="n">autoconRPi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTCPAutoConnStatus</span><span class="p">()</span>  <span class="c1"># Auto-connection preference for the RPi server and client</span>
        <span class="n">clientIP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getHost</span><span class="p">()</span>
        <span class="n">stellIP</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="n">remoteIP</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>
        <span class="n">servRPiRemote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getServRemote</span><span class="p">(</span><span class="s2">&quot;TCPRPiServ&quot;</span><span class="p">)</span>
        <span class="n">stellServRemote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getServRemote</span><span class="p">(</span><span class="s2">&quot;TCPStell&quot;</span><span class="p">)</span>

        <span class="c1"># If auto-connection is selected for thr TCP section, then do as requested</span>
        <span class="k">if</span> <span class="n">autoconStell</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellServAutoStartBtn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">autoconRPi</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">teleAutoConChoice</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clientIP</span> <span class="o">==</span> <span class="s2">&quot;localhost&quot;</span> <span class="ow">or</span> <span class="n">clientIP</span> <span class="o">==</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telClientBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telClientBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">servRPiRemote</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="ow">or</span> <span class="n">stellServRemote</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ipAddress</span> <span class="ow">in</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QNetworkInterface</span><span class="o">.</span><span class="n">allAddresses</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ipAddress</span> <span class="o">!=</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QHostAddress</span><span class="o">.</span><span class="n">LocalHost</span> <span class="ow">and</span> <span class="n">ipAddress</span><span class="o">.</span><span class="n">toIPv4Address</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>  <span class="c1"># If we found an IP then we exit the loop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ipAddress</span> <span class="o">=</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QHostAddress</span><span class="o">.</span><span class="n">LocalHost</span>  <span class="c1"># If no IP is found, assign localhost</span>
            <span class="n">remoteIP</span> <span class="o">=</span> <span class="n">ipAddress</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>  <span class="c1"># Assign the IP address that wa found above</span>

        <span class="k">if</span> <span class="n">servRPiRemote</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">servRPiRemote</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">servRPiRemote</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stellServRemote</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellIPServBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stellIP</span> <span class="o">=</span> <span class="n">remoteIP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellIPServBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Set all the text fields with the correct data</span>
        <span class="c1"># TODO handle what happens when server is not initialized at start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPAddrClient</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">clientIP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPPortClient</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getPort</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPAddrServ</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">remoteIP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPPortServ</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getRPiPort</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellServInpIP</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stellIP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellPortServ</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getStellPort</span><span class="p">())</span>

        <span class="c1"># Set the settings for the connection test tab</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QAbstractSocket</span><span class="o">.</span><span class="n">ConnectedState</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">clientStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QAbstractSocket</span><span class="o">.</span><span class="n">ConnectedState</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">servStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">servStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">servStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">serverStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QAbstractSocket</span><span class="o">.</span><span class="n">ConnectedState</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellariumStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellariumStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellConTestChkBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellStatLbl</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellariumStatus</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="c1"># Save the settings when the save button is pressed</span>
<div class="viewcode-block" id="OpHandler.saveTCPSettings"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.saveTCPSettings">[docs]</a>    <span class="k">def</span> <span class="nf">saveTCPSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Save the ports entered for each setting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setPort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPPortClient</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setStellPort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellPortServ</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setRPiPort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPPortServ</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># Save the auto start/enable option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">teleAutoConChoice</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">TCPAutoConnEnable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">TCPAutoConnDisable</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellServAutoStartBtn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">TCPStellAutoConnEnable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">TCPStellAutoConnDisable</span><span class="p">()</span>

        <span class="c1"># Save the IP addresses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Localhost&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setRPiHost</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCPRPiServ&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Remote&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCPRPiServ&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setRPiHost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPAddrServ</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telServBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Custom&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCPRPiServ&quot;</span><span class="p">,</span> <span class="s2">&quot;custom&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setRPiHost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPAddrServ</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telClientBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Localhost&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setHost</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCP&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCP&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setHost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeIPAddrClient</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellIPServBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Localhost&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setStellHost</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCPStell&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setServRemote</span><span class="p">(</span><span class="s2">&quot;TCPStell&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setStellHost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">stellServInpIP</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># Send a reconnect signal to all TCP operations (No effect if some is not active)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">reConnectSigC</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">reConnectSigR</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">reConnectSigS</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.locationSettingsHandle"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.locationSettingsHandle">[docs]</a>    <span class="k">def</span> <span class="nf">locationSettingsHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s_latlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getLatLon</span><span class="p">()</span>  <span class="c1"># First element is latitude and second element is longitude</span>
        <span class="n">s_alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getAltitude</span><span class="p">()</span>  <span class="c1"># Get the altitude from the settings file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">latEntry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">s_latlon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">lonEntry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">s_latlon</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">altEntry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">s_alt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getMapsSelect</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">locationTypeChoose</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.saveLocationSettings"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.saveLocationSettings">[docs]</a>    <span class="k">def</span> <span class="nf">saveLocationSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">latEntry</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">lonEntry</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span>
        <span class="n">altd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">altEntry</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setLatLon</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setAltitude</span><span class="p">(</span><span class="n">altd</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">locationTypeChoose</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Google Maps&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setMapsSelect</span><span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setMapsSelect</span><span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">)</span>

        <span class="c1"># Show location on the GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">lonTextInd</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p align=</span><span class="se">\&quot;</span><span class="s2">center</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">&lt;span style=</span><span class="se">\&quot;</span><span class="s2"> &quot;</span>
                                             <span class="s2">&quot;vertical-align:super;</span><span class="se">\&quot;</span><span class="s2">&gt;o&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">latTextInd</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p align=</span><span class="se">\&quot;</span><span class="s2">center</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">&lt;span style=</span><span class="se">\&quot;</span><span class="s2"> &quot;</span>
                                             <span class="s2">&quot;vertical-align:super;</span><span class="se">\&quot;</span><span class="s2">&gt;o&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">altTextInd</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p align=</span><span class="se">\&quot;</span><span class="s2">center</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="s2">m&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">altd</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.homePositionReturn"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.homePositionReturn">[docs]</a>    <span class="k">def</span> <span class="nf">homePositionReturn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;RETURN_HOME</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.planObjCommand"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.planObjCommand">[docs]</a>    <span class="k">def</span> <span class="nf">planObjCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">home_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getHomeSteps</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">planObjectTransitGroupBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">objec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">objectSelectionComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">tr_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">transitTimeBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">transit_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">transit_planetary</span><span class="p">(</span><span class="n">objec</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                                                  <span class="nb">int</span><span class="p">(</span><span class="n">tr_time</span><span class="p">))</span>

                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRNST_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">transit_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transit_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>  <span class="c1"># Send the transit command to the RPi</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">planObjectTrackingGroupBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">objec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">objectSelectionComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">track_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">trackingtTimeBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">tracking_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">tracking_planetary</span><span class="p">(</span><span class="n">objec</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRK_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="s2">_RA-SPEED_</span><span class="si">%.5f</span><span class="s2">_DEC-SPEED_</span><span class="si">%.5f</span><span class="s2">_TIME_</span><span class="si">%.2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> \
                          <span class="p">(</span><span class="n">tracking_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tracking_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tracking_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tracking_info</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">track_time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>  <span class="c1"># Send the tracking command to the RPi</span></div>

<div class="viewcode-block" id="OpHandler.coordinateFormatter"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.coordinateFormatter">[docs]</a>    <span class="k">def</span> <span class="nf">coordinateFormatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">degree</span><span class="p">:</span>
            <span class="n">formated_coord</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;</span><span class="si">%.4f</span><span class="s2">&lt;span style=&quot;</span> \
                             <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> vertical-align:super;</span><span class="se">\&quot;</span><span class="s2">&gt;o&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">num</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formated_coord</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;</span><span class="si">%.4f</span><span class="s2">&lt;span style=</span><span class="se">\&quot;</span><span class="s2"> &quot;</span> \
                             <span class="s2">&quot;vertical-align:super;</span><span class="se">\&quot;</span><span class="s2">&gt;h&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> <span class="o">%</span> <span class="n">num</span>

        <span class="k">return</span> <span class="n">formated_coord</span>  <span class="c1"># Return the formatted coordinate string</span></div>

<div class="viewcode-block" id="OpHandler.calcScanPoints"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.calcScanPoints">[docs]</a>    <span class="k">def</span> <span class="nf">calcScanPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">point_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point1Coord_1Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point1Coord_2Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="p">)</span>
        <span class="n">point_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point2Coord_1Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point2Coord_2Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="p">)</span>
        <span class="n">point_3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point3Coord_1Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point3Coord_2Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="p">)</span>
        <span class="n">point_4</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point4Coord_1Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">point4Coord_2Field</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setStyleSkyScanningSig</span><span class="o">.</span><span class="n">emit</span><span class="p">((</span><span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">point_3</span><span class="p">,</span> <span class="n">point_4</span><span class="p">,</span> <span class="p">))</span>

        <span class="n">check_1</span> <span class="o">=</span> <span class="n">point_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">check_2</span> <span class="o">=</span> <span class="n">point_3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">point_4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">check_1</span> <span class="ow">and</span> <span class="n">check_2</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">coord_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">coordinateSystemComboBx</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">epochDateSelection</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="s2">&quot;yyyy/MM/dd&quot;</span><span class="p">)</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">directionSelection</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

            <span class="n">step_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">stepSizeBoxCoord1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">step_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">stepSizeBoxCoord2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">step_x</span><span class="p">,</span> <span class="n">step_y</span><span class="p">,</span> <span class="p">)</span>  <span class="c1"># Step size in each axis</span>

            <span class="n">point_1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">point_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">point_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>
            <span class="n">point_2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">point_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">point_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>
            <span class="n">point_3</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">point_3</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">point_3</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>
            <span class="n">point_4</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">point_4</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">point_4</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>

            <span class="n">points</span> <span class="o">=</span> <span class="p">(</span><span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">point_3</span><span class="p">,</span> <span class="n">point_4</span><span class="p">,</span> <span class="n">coord_system</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">map_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">scanning_map_generator</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
            <span class="n">num_of_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">map_points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Number of points to be scanned</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">integrationEnabler</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">total_int_time</span> <span class="o">=</span> <span class="n">num_of_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">integrationTimeEntry</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="mf">60.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">totalIntTime</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">total_int_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">totalPointsToScan</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_of_points</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">simulateScanningChk</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">sim_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">simSpeedValue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">simStopSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># First stop any ongoing simulation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">simStartSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">map_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sim_speed</span><span class="p">)</span>  <span class="c1"># Then send the new points</span>

            <span class="k">return</span> <span class="n">map_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">pointOperationTabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.skyScanStart"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.skyScanStart">[docs]</a>    <span class="k">def</span> <span class="nf">skyScanStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO Add a perform calculation warning to the user</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>  <span class="c1"># TODO Set the condition to the correct one</span>
            <span class="n">map_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcScanPoints</span><span class="p">()</span>  <span class="c1"># Get the mapping points</span>
            <span class="k">if</span> <span class="n">map_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">():</span>
                <span class="n">home_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getHomeSteps</span><span class="p">()</span>
                <span class="n">init_steps</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">)</span>

                <span class="n">step_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">stepSizeBoxCoord1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">step_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">stepSizeBoxCoord2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">step_x</span><span class="p">,</span> <span class="n">step_y</span><span class="p">,)</span>  <span class="c1"># Step size in each axis</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">integrationEnabler</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">int_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">integrationTimeEntry</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">int_time</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">planetaryObjectSelectcheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">objec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">objectSelectionComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">objec</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">calc_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">scanning_point_calculator</span><span class="p">(</span><span class="n">map_points</span><span class="p">,</span> <span class="n">init_steps</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span>
                                                                       <span class="n">int_time</span><span class="p">,</span> <span class="n">objec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;SKY-SCAN_RA_</span><span class="si">%f</span><span class="s2">_DEC_</span><span class="si">%f</span><span class="s2">_RA-SPEED_</span><span class="si">%f</span><span class="s2">_DEC-SPEED_</span><span class="si">%f</span><span class="s2">_INT-TIME_</span><span class="si">%.2f</span><span class="s2">&quot;</span>
                                             <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">calc_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">calc_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
                                                <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">calc_points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">calc_points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">int_time</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;SKY-SCAN-MAP_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">calc_points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">calc_points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># TODO Remove the print statement</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.calibration_reposition"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.calibration_reposition">[docs]</a>    <span class="k">def</span> <span class="nf">calibration_reposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_enabled</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">coordinatSystemcomboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">home_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getHomeSteps</span><span class="p">()</span>  <span class="c1"># Return a list with the steps way from home position</span>
            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Satellite&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">calibCoord_1_Label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;Satellite...&quot;</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">geo_sat_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sat_sel_diag</span><span class="o">.</span><span class="n">satSelectionList</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">coord_1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the HA</span>
                <span class="n">coord_2</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Get the DEC</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRNST_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coord_1</span><span class="p">,</span> <span class="n">coord_2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Motor steps&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coord_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">calibCoord_1_Text</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="n">coord_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">calibCoord_2_Text</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;MANCONT_MOVE_</span><span class="si">%d</span><span class="s2">_</span><span class="si">%d</span><span class="s2">_</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">coord_1</span><span class="p">,</span> <span class="n">coord_2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coord_1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">calibCoord_1_Text</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="n">coord_2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">calibCoord_2_Text</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="n">coord_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord_1</span><span class="p">,</span> <span class="n">coord_2</span><span class="p">,</span> <span class="p">)</span>
                    <span class="n">sys_date_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span> <span class="p">)</span>

                    <span class="n">final_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">coordinate_transform</span><span class="p">(</span><span class="n">coord_tuple</span><span class="p">,</span> <span class="n">sys_date_tuple</span><span class="p">)</span>
                    <span class="n">transit_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">transit</span><span class="p">(</span><span class="n">final_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">final_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">home_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TRNST_RA_</span><span class="si">%.5f</span><span class="s2">_DEC_</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">transit_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transit_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>  <span class="c1"># Send the transit command to set the calibration position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">motorsDisabledSig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.sat_coords_setter"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.sat_coords_setter">[docs]</a>    <span class="k">def</span> <span class="nf">sat_coords_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">satellite</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">sat</span> <span class="o">=</span> <span class="n">satellite</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">satellite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sat_sel_diag</span><span class="o">.</span><span class="n">satSelectionList</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">astronomy</span><span class="o">.</span><span class="n">geo_sat_position</span><span class="p">(</span><span class="n">satellite</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">updateCoordFieldsSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.save_tle_settings"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.save_tle_settings">[docs]</a>    <span class="k">def</span> <span class="nf">save_tle_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setTLEURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tle_settings_widg</span><span class="o">.</span><span class="n">tleURL</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setTLEautoUpdate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tle_settings_widg</span><span class="o">.</span><span class="n">autoUpdateSelection</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">setTLEupdateInterval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tle_settings_widg</span><span class="o">.</span><span class="n">intervalValue</span><span class="o">.</span><span class="n">value</span><span class="p">())</span></div>

<div class="viewcode-block" id="OpHandler.show_tle_info"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.show_tle_info">[docs]</a>    <span class="k">def</span> <span class="nf">show_tle_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">auto_updt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTLEautoUpdate</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTLEURL</span><span class="p">()</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgData</span><span class="o">.</span><span class="n">getTLEupdateInterval</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">auto_updt</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setTLEDataSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.settings_saver"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.settings_saver">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;notifierToSaveTheSettingsSignal&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">settings_saver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="s2">&quot;TLE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_tle_settings</span><span class="p">()</span></div>

<div class="viewcode-block" id="OpHandler.getTLE"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.getTLE">[docs]</a>    <span class="k">def</span> <span class="nf">getTLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleStatusInfoSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Just initialize the widget</span>
        <span class="n">tle_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tle_operations</span><span class="o">.</span><span class="n">tle_retriever</span><span class="p">()</span>  <span class="c1"># Get the new TLE file</span>

        <span class="k">if</span> <span class="n">tle_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;Success^TLE file(s) updated&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tle_status_msg</span> <span class="o">=</span> <span class="s2">&quot;Error^There was a problem getting TLE file(s).^&quot;</span>
            <span class="n">tle_status_msg</span> <span class="o">+=</span> <span class="n">tle_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tleStatusInfoSig</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">tle_status_msg</span><span class="p">)</span></div>

    <span class="c1"># Make all the necessary signal connections</span>
<div class="viewcode-block" id="OpHandler.signalConnections"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.signalConnections">[docs]</a>    <span class="k">def</span> <span class="nf">signalConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect all the necessary signals from the different modules.</span>
<span class="sd">        This function is called at the start of the Operation handling thread.</span>

<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">sendClientConn</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stellCommSend</span><span class="p">)</span>  <span class="c1"># Send data from Stellarium to the RPi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">dataRcvSigC</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clientDataRx</span><span class="p">)</span>  <span class="c1"># Receive pending data from RPi connected client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">newConInitComms</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialCommands</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">dataRxFromServ</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpiServRcvData</span><span class="p">)</span>  <span class="c1"># Receive data from the RPi server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">clientNotice</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">connectCl</span><span class="p">)</span>  <span class="c1"># Tell the client to reconnect</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">stopMovingRTSig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stopMovingRT</span><span class="p">)</span>  <span class="c1"># Send a motion stop command, once this signal is triggered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">stellPosUpdtBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">,</span> <span class="s2">&quot;SEND_POS_UPDATE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posDataShow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">posDataShow</span><span class="p">)</span>  <span class="c1"># Show the dish position data, when available</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">conTestBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testConnButton</span><span class="p">)</span>

        <span class="c1"># Give functionality to the buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectRadioTBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectButtonR</span><span class="p">)</span>  <span class="c1"># TCP client connection button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">serverRPiConnBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectButtonRPi</span><span class="p">)</span>  <span class="c1"># TCP server connection button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">connectStellariumBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectButtonS</span><span class="p">)</span>  <span class="c1"># Stellarium TCP server connection button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">motorCommandButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motorsEnableButton</span><span class="p">)</span>  <span class="c1"># Enable/Disable the motors on RPi</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">movRaBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manCont_movRA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">movDecBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manCont_movDEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">syncMoveBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manCont_movBoth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">man_cn_widg</span><span class="o">.</span><span class="n">stopMotMotionBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manCont_stop</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tcp_widg</span><span class="o">.</span><span class="n">telescopeSaveBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveTCPSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">loc_widg</span><span class="o">.</span><span class="n">saveBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveLocationSettings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">actionSettings</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TCPSettingsHandle</span><span class="p">)</span>  <span class="c1"># Update settings each time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">actionLocation</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locationSettingsHandle</span><span class="p">)</span>  <span class="c1"># Update location fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">actionManual_Control</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">sendData</span><span class="o">.</span><span class="n">emit</span><span class="p">,</span>
                                                                         <span class="s2">&quot;SEND_HOME_STEPS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">locatChangeBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locationSettingsHandle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">homePositionButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">homePositionReturn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plan_obj_win</span><span class="o">.</span><span class="n">commandExecutionBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">planObjCommand</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">calculateScanMapBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calcScanPoints</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sky_scan_win</span><span class="o">.</span><span class="n">startScanBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skyScanStart</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">calib_win</span><span class="o">.</span><span class="n">repositionButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_reposition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sat_sel_diag</span><span class="o">.</span><span class="n">satSelectionList</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sat_coords_setter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sat_sel_diag</span><span class="o">.</span><span class="n">coordinateSystemBox</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sat_coords_setter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">saveSettingsSig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings_saver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tle_settings_widg</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">saveWaringSig</span><span class="o">.</span><span class="n">emit</span><span class="p">,</span> <span class="s2">&quot;TLE&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_widg</span><span class="o">.</span><span class="n">actionTLE_Settings</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_tle_info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tle_settings_widg</span><span class="o">.</span><span class="n">tleDownloadButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTLE</span><span class="p">)</span>  <span class="c1"># Retrieve the TLE upon user request</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All signal connections made&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpHandler.appExitRequest"><a class="viewcode-back" href="../rst/OperationHandler.html#OperationHandler.OpHandler.appExitRequest">[docs]</a>    <span class="k">def</span> <span class="nf">appExitRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called whenever the app is about to quit.</span>
<span class="sd">        First quit from the thread and then delete both the thread and the corresponding object</span>
<span class="sd">        Quit exits the thread and then wait is waiting for the thread exit</span>
<span class="sd">        deleteLater, deletes the thread object and the threaded object</span>

<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClient</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpClThread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Client thread is closed for sure&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServer</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpServThread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RPi server thread is surely closed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStellarium</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcpStelThread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stellarium server thread is closed for sure and operations handler thread closed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simHandler</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simThread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logD</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Simulation handler thread is closed.&quot;</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Radio Telescope Controller</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rst/modules.html">Handlers</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Dimitrios Stoupis.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>